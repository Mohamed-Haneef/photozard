function previewPhoto(e){const o=new FileReader;o.onload=function(){document.getElementById("profile-photo-preview").src=o.result},o.readAsDataURL(e.target.files[0])}async function delete_current_profile(e){try{var o=await fetch("/api/profile/deleteprofile?profile="+encodeURIComponent(e),{method:"DELETE"}),t=await o.json();if(o.ok)return alert("Successfully deleted"),t;{let e="Unknown error occurred";if(t.error)try{var r=JSON.parse(t.error);e=r.message||"Unknown error occurred"}catch{e=t.error}return alert("Error: "+e),{status:"error",message:e}}}catch(e){return alert("Failed to delete profile image: "+e.message),{status:"error",message:e.message}}}$("#share-memory").on("click",function(){var o=$(this),e=(o.prop("disabled",!0),new FormData),r=$("#post_image")[0].files;""==$("#post_text").val()?((t=new Toast("Error","now","Please enter a caption")).show(),o.prop("disabled",!1)):0<r.length?(e.append("post_image",r[0]),e.append("post_text",$("#post_text").val()),$.ajax({url:"/api/posts/add",type:"POST",data:e,contentType:!1,processData:!1,success:function(e){console.log("File uploaded successfully"),console.log(e),e=$(e),$grid.prepend(e).masonry("prepended",e).masonry("layout"),$grid.imagesLoaded().progress(function(){$grid.masonry("layout")}),$("#post_image").val(""),$("#post_text").val("");e=parseInt($("#total-posts-count").text());e+=1,$("#total-posts-count").html(e),o.prop("disabled",!1)},error:function(e){console.error("Error uploading file"),console.log(e),o.prop("disabled",!1),modalMessage("Error occured","Unable to upload image!")}})):(t=new Toast("Error","now","Please select a file to upload")).show()}),$.post("/api/posts/count",{id:10},function(e){console.log(e),$("#total-posts-count").html(e.count)}),$(document).on("click",".album .btn-delete",function(){post_id=$(this).parent().attr("data-id"),(d=new Dialog("Delete Post","Are you sure want to remove this post")).setButtons([{name:"Delete",class:"btn-danger",onClick:function(e){$.post("/api/posts/delete",{id:post_id},function(e,o,t){console.log(o),console.log(e),"success"==o&&(e=$("#post-"+post_id)[0],$grid.masonry("remove",e).masonry("layout"),o=parseInt($("#total-posts-count").text()),--o,$("#total-posts-count").html(o))}),$(e.data.modal).modal("hide")}},{name:"Cancel",class:"btn-secondary",onClick:function(e){$(e.data.modal).modal("hide")}}]),d.show()}),$(document).on("click",".album .btn-like",function(){var e=$(this).parent().attr("data-id"),r=$(this);formData={id:e},$.ajax({type:"POST",url:"/api/posts/like",data:formData,success:function(e){var o,t,e=e.success;null!==e?(o=r.closest(".card-body").find("#total-like-count"),t=parseInt(o.html()),1==e?(r.html("Liked"),r.removeClass("btn-outline-primary").addClass("btn-primary"),r.blur(),t+=1,console.log("total like: "+t),console.log("total like: "+o),o.html(t)):0==e?(r.html("Like"),r.removeClass("btn-primary").addClass("btn-outline-primary"),r.blur(),console.log("total like(bfr): "+t),--t,console.log("total like(aftr): "+t),o.html(t)):alert("Unable to process the like. Please try again")):alert("Some error while liking")},error:function(e,o){var t;void 0!==e.responseJSON?(t=e.responseJSON.error)?alert("Error: "+t):alert("Error response not found"+JSON.stringify(e.responseJSON)):alert(e.responseJSON)}})}),$(document).ready(function(){$("#login-form").on("submit",function(e){e.preventDefault();var e=$("#user").val(),o=$("#password").val();e&&o?e.length<5?modalMessage("Format error","Username must be at least 5 characters long."):$.ajax({type:"POST",url:"/api/auth/login",data:{username:e,password:o},success:function(e){null!==e.success&&(alert("Login success, you will be redirected"),window.location.href="/")},error:function(e,o){var t;void 0!==e.responseJSON?(t=e.responseJSON.error)?modalMessage("Error",t):modalMessage("error response not found",JSON.stringify(e.responseJSON)):modalMessage("Internal error",e.responseJSON)}}):modalMessage("Missing fields","You need to fill both the fields to login")})}),$(document).ready(function(){$("#signup-form").on("submit",function(e){e.preventDefault();var e=$("#username").val(),o=$("#email_address").val(),t=$("#phone").val(),r=$("#date_of_birth").val(),a=$("#password").val();e&&o&&t&&r&&a?e.length<5?modalMessage("Format error","Username must be at least 5 characters long."):/^[0-9]{10}$/.test(t)?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?$.ajax({type:"POST",url:"/api/auth/signup",data:{username:e,email_address:o,phone:t,date_of_birth:r,password:a},success:function(e){null!==e.success&&(alert("Signup success now you can login to continue.."),window.location.href="/login?signup=true")},error:function(e,o){void 0!==e.responseJSON&&(e=e.responseJSON.error)?modalMessage("Error Signing up",e):modalMessage("Unable to signup","Please wait for sometime and try again later")}}):modalMessage("Format error","Please enter a valid email address."):modalMessage("Format error","Invalid phone number. It should be a 10-digit number without spaces or special characters."):modalMessage("Missing fields","You need to fill all the given fields to Signup")})}),"/profile"==window.location.pathname&&$("#edit-profile").on("submit",function(e){e.preventDefault();var e=new FormData,t=$("#profile-photo")[0].files,o=(console.log("image value: "+t[0]),$("#profile-photo-preview").attr("data"));console.log("Photoroute: "+o),"/profileimg/default.jpeg"!==o&&t.length<=0?e.append("user_profile",o):e.append("user_profile",t[0]),e.append("username",$("#edit-username").val()),e.append("date_of_birth",$("#edit-date_of_birth").val()),e.append("bio",$("#edit-bio").val()),e.append("instagram",$("#edit-instagram").val()),e.append("twitter",$("#edit-twitter").val()),e.append("facebook",$("#edit-facebook").val()),$.ajax({url:"/api/profile/updateprofile",type:"POST",data:e,contentType:!1,processData:!1,success:async function(e){var o=e.success;null!==o&&(alert(o+": profile updated"),o=e.path,e=$("#profile-photo-preview").attr("data"),$("#profile-photo-preview").attr("src"),$("#profile-photo-preview").attr("data",o),console.log("Photo path: "+e),console.log("new path: "+o),"/profileimg/default.jpeg"!==o)&&"/profileimg/default.jpeg"!==e&&null==t[0]&&(console.log("Delete condition true"),await delete_current_profile(e),console.log("Deleted"))},error:function(e,o){var t;void 0!==e.responseJSON?(t=e.responseJSON.error)?(alert("Error: "+t),modalMessage("Error",t)):modalMessage("error response not found",JSON.stringify(e.responseJSON)):modalMessage("Internal error",e.responseJSON)}})});let $grid=$("#masonry-area").masonry({percentPosition:!0});function setCookie(e,o,t){var r,a="";t&&((r=new Date).setTime(r.getTime()+24*t*60*60*1e3),a="; expires="+r.toUTCString()),document.cookie=e+"="+o+a+"; path=/"}$grid.imagesLoaded().progress(function(){$grid.masonry("layout")});
//# sourceMappingURL=app.min.js.map